generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  user_id           Int      @id @default(autoincrement())
  email             String?  @unique
  phone             String?  @unique
  telegram_name     String?
  telegram_username String?
  telegram_user_id  String   @unique
  country           String?
  city              String?
  image             String?
  created_at        DateTime @default(now())

  fuels        Fuel[]
  maintenances Maintenance[]
  trips        Trip[]
  accounts     Account[]
  categories   Category[]
  transactions Transaction[]
}

model Fuel {
  gas_id     Int      @id @default(autoincrement())
  user_id    Int
  liters     Float
  price      Float
  station    String   @db.VarChar(255)
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  user User @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
}

model Maintenance {
  maintenance_id Int      @id @default(autoincrement())
  user_id        Int
  date           DateTime
  description    String   @db.Text
  odometer       Int
  created_at     DateTime @default(now())
  updated_at     DateTime @default(now()) @updatedAt

  user User @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
}

model Trip {
  trip_id          Int      @id @default(autoincrement())
  telegram_user_id String
  kilometrs        Float
  direction        String   @db.Text
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  user User @relation(fields: [telegram_user_id], references: [telegram_user_id], onDelete: Cascade)
}

model Account {
  account_id Int      @id @default(autoincrement())
  user_id    Int
  name       String
  currency   String   @default("UAH")
  balance    Float    @default(0)
  created_at DateTime @default(now())

  user         User          @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  transactions Transaction[]
}

model Category {
  category_id Int    @id @default(autoincrement())
  user_id     Int
  name        String
  type        String

  user         User          @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  transactions Transaction[]
}

model Transaction {
  transaction_id Int      @id @default(autoincrement())
  user_id        Int
  account_id     Int
  category_id    Int
  amount         Float
  description    String?
  date           DateTime @default(now())

  user     User     @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  account  Account  @relation(fields: [account_id], references: [account_id], onDelete: Cascade)
  category Category @relation(fields: [category_id], references: [category_id], onDelete: Cascade)
}
